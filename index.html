<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Desenho ao Vivo</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase v8 (compatÃ­vel com seu cÃ³digo) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    body {
      margin: 0;
      background: #111;
      color: white;
      text-align: center;
      font-family: Arial;
    }

    canvas {
      background: white;
      touch-action: none;
      width: 100vw;
      height: 80vh;
      display: block;
    }

    .controls {
      padding: 10px;
    }

    button {
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <canvas id="canvas"></canvas>

  <div class="controls">
    <button id="clear">Limpar tudo</button>
  </div>

  <script>
    // ðŸ”¥ SEU FIREBASE
    const firebaseConfig = {
      apiKey: "AIzaSyBdxd54oFM3eWH1duC5BTdJzjGGRDLMq-Q",
      authDomain: "mary-cb817.firebaseapp.com",
      databaseURL: "https://mary-cb817-default-rtdb.firebaseio.com",
      projectId: "mary-cb817",
      storageBucket: "mary-cb817.firebasestorage.app",
      messagingSenderId: "887348832569",
      appId: "1:887348832569:web:c6d9c32a1a1c402b8960e8"
    };

    // Inicializa Firebase
    firebase.initializeApp(firebaseConfig);

    const database = firebase.database();
    const roomRef = database.ref("sala1");

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight * 0.8;
    }
    resize();
    window.addEventListener("resize", resize);

    let drawing = false;
    let lastX = 0;
    let lastY = 0;

    function drawLine(x1, y1, x2, y2) {
      ctx.strokeStyle = "#000";
      ctx.lineWidth = 3;
      ctx.lineCap = "round";

      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.stroke();
    }

    function start(x, y) {
      drawing = true;
      lastX = x;
      lastY = y;
    }

    function move(x, y) {
      if (!drawing) return;

      drawLine(lastX, lastY, x, y);

      roomRef.push({
        x1: lastX,
        y1: lastY,
        x2: x,
        y2: y
      });

      lastX = x;
      lastY = y;
    }

    function stop() {
      drawing = false;
    }

    // Mouse
    canvas.addEventListener("mousedown", e => start(e.offsetX, e.offsetY));
    canvas.addEventListener("mousemove", e => move(e.offsetX, e.offsetY));
    window.addEventListener("mouseup", stop);

    // Touch (celular)
    canvas.addEventListener("touchstart", e => {
      const t = e.touches[0];
      start(t.clientX, t.clientY);
    });

    canvas.addEventListener("touchmove", e => {
      const t = e.touches[0];
      move(t.clientX, t.clientY);
    });

    window.addEventListener("touchend", stop);

    // ðŸ”´ Recebe desenho em tempo real
    roomRef.on("child_added", snap => {
      const d = snap.val();
      drawLine(d.x1, d.y1, d.x2, d.y2);
    });

    // Limpar tudo
    document.getElementById("clear").onclick = () => {
      roomRef.remove();
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    };
  </script>

</body>
</html>
